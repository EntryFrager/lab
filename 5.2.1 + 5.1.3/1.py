import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import find_peaks

# --- 1. Ввод данных (Ток в мкА) ---

# Данные для V_z = 2 В
u_2V = np.array(
    [
        78.08,
        65.18,
        60.65,
        54.97,
        50.82,
        44.56,
        40.23,
        35.48,
        30.56,
        25.09,
        20.87,
        14.97,
        10.43,
        4.73,
        22.07,
        23.99,
        26.66,
        28.17,
        31.30,
        29.92,
        32.46,
        33.68,
        34.59,
        36.75,
        37.98,
        38.76,
        40.97,
        41.58,
        42.72,
        43.45,
        44.08,
        45.54,
        46.76,
        48.58,
        16.88,
        17.69,
        18.39,
        19.12,
        19.48,
        20.27,
        21.12,
    ]
)
i_2V = np.array(
    [
        375,
        328,
        318,
        293,
        263,
        241,
        243,
        251,
        203,
        142,
        154,
        135,
        102,
        56,
        126,
        130,
        161,
        179,
        215,
        196,
        227,
        240,
        247,
        255,
        254,
        252,
        236,
        234,
        233,
        236,
        238,
        244,
        248,
        259,
        155,
        162,
        166,
        168,
        168,
        165,
        151,
    ]
)

# Данные для V_z = 4 В
u_4V = np.array(
    [
        78.17,
        63.25,
        60.09,
        55.00,
        50.09,
        45.05,
        40.15,
        35.23,
        30.56,
        25.05,
        20.10,
        15.03,
        10.01,
        5.30,
        17.05,
        18.14,
        19.10,
        20.99,
        22.04,
        23.06,
        22.50,
        24.14,
        23.56,
        26.06,
        27.04,
        28.03,
        29.16,
        33.23,
        34.09,
        36.87,
        38.20,
        41.23,
        42.30,
        43.03,
        44.07,
        46.26,
        47.47,
        48.82,
        51.71,
        52.18,
    ]
)
i_4V = np.array(
    [
        278,
        255,
        252,
        223,
        190,
        175,
        203,
        213,
        157,
        75,
        157,
        129,
        88,
        47,
        146,
        153,
        158,
        152,
        141,
        79,
        126,
        70,
        71,
        89,
        107,
        120,
        138,
        193,
        202,
        221,
        218,
        194,
        186,
        183,
        178,
        177,
        179,
        183,
        202,
        201,
    ]
)

# Данные для V_z = 6 В
u_6V = np.array(
    [
        78.09,
        63.61,
        60.37,
        55.01,
        50.20,
        45.11,
        40.10,
        35.13,
        30.10,
        25.01,
        20.10,
        15.03,
        10.18,
        5.00,
        15.97,
        17.23,
        18.31,
        19.16,
        21.06,
        22.04,
        23.17,
        24.02,
        23.57,
        23.45,
        26.06,
        27.01,
        28.35,
        29.15,
        31.03,
        33.50,
        36.34,
        38.2,
        42.32,
        44.05,
        46.96,
        48.39,
        51.23,
        52.81,
        53.98,
        56.07,
        57.69,
        47.61,
        45.96,
        43.41,
    ]
)
i_6V = np.array(
    [
        161,
        163,
        162,
        138,
        115,
        120,
        153,
        157,
        89,
        34,
        141,
        110,
        70,
        27,
        116,
        126,
        134,
        140,
        140,
        133,
        106,
        39,
        50,
        58,
        38,
        45,
        62,
        75,
        104,
        138,
        165,
        167,
        139,
        128,
        114,
        112,
        120,
        127,
        133,
        147,
        155,
        113,
        119,
        133,
    ]
)

datasets = [(u_2V, i_2V, 2, "blue"), (u_4V, i_4V, 4, "green"), (u_6V, i_6V, 6, "red")]

# --- 2. Настройка погрешностей ---
x_err = 0.1  # В
y_err = 1.0  # мкА

# --- 3. Обработка и построение ---

plt.figure(figsize=(12, 8))

for u, i, vz, color in datasets:
    # Сортировка
    sorted_indices = np.argsort(u)
    u_sorted = u[sorted_indices]
    i_sorted = i[sorted_indices]

    # Поиск пиков (для подписей)
    peaks_idx, _ = find_peaks(i_sorted, prominence=10, distance=2)
    valleys_idx, _ = find_peaks(-i_sorted, prominence=10, distance=2)

    current_peaks_idx = peaks_idx[:3]
    current_valleys_idx = valleys_idx[:3]

    # ПОСТРОЕНИЕ ГРАФИКА С КРЕСТАМИ ПОГРЕШНОСТЕЙ
    # fmt='.' - точки, linestyle='-' - линия соединения
    # capsize=2 - размер "шляпок" на концах крестов
    plt.errorbar(
        u_sorted,
        i_sorted,
        xerr=x_err,
        yerr=y_err,
        fmt=".",
        linestyle="-",
        color=color,
        ecolor=color,  # цвет самого креста ошибки
        elinewidth=1,  # толщина линий ошибки
        capsize=2,  # "усы" на концах креста
        label=f"$V_z = {vz}$ В",
        alpha=0.7,
    )


# --- 4. Оформление графика ---
plt.title(f"ВАХ опыта Франка-Герца")
plt.xlabel("$U_a$, В")
plt.ylabel("$I_k$, мкА")
plt.grid(True, which="major", linestyle="-", alpha=0.6)
plt.grid(True, which="minor", linestyle="--", alpha=0.3)
plt.minorticks_on()  # Включаем мелкую сетку для лучшей читаемости
plt.legend()
plt.tight_layout()
plt.show()
